package com.schwartz.util;

import org.codehaus.jettison.json.JSONArray;
import org.codehaus.jettison.json.JSONObject;

import java.sql.ResultSet;

/** This utility will convert database data into JSON format.
 * 
 * @author betty80906
 *
 */

public class ToJSON {
	
	/**
	 * This will convert database records into a JSON Array
	 * Simply pass in a ResultSet from a database connetion, 
	 * and it will loop through and return a JSON array.
	 * 
	 * @param rs - database ResultSet
	 * @return - JSON array
	 * @throws Exception
	 */
	
	public JSONArray toJSONArray(ResultSet rs) throws Exception {
		
		JSONArray json = new JSONArray();  //JSON array that will be returned
		
		try{
			//this will sae the table meta-data column name
			java.sql.ResultSetMetaData rsmd = rs.getMetaData();
			
			//loop through the ResultSet
			while( rs.next() ) {
			    //get number of columns
				int numColumns = rsmd.getColumnCount();
				//each row in the ResultSet will be converted to a JSON Object
				JSONObject obj = new JSONObject();
				
				//loop through all the columns and place them into the JSON Object
				for ( int i=1; i<numColumns+1; i++) {
					String column_name = rsmd.getColumnName(i);
					if (rsmd.getColumnType(i)== java.sql.Types.ARRAY){
					  obj.put(column_name, rs.getArray(column_name));
					  /*Debug*/ System.out.println("ToJson:  ARRAY");
					}
				}
			
			}
				
		}
	}

}
